"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,r,a){return{createCube:function(e,a){var o=a.layout,s=r.validateDimension(o.props.dimensions[0]),t=[{qDef:{qFieldDefs:[s]}}],i=o.props.measures.length;a.rowsLabel=[r.validateMeasure(o.props.measures[0])];for(var p=r.validateMeasure(o.props.measures[0])+" as mea0",l="q$mea0",n="N",d=1;d<i;d++){var u=r.validateMeasure(o.props.measures[d]);if(u.length>0){var c=","+u+" as mea"+d;p+=c,l+=",q$mea"+d,n+="N",a.rowsLabel.push(r.validateMeasure(o.props.measures[d]))}}r.displayDebugModeMessage(o.props.debugMode);var f=r.getDebugSaveDatasetScript(o.props.debugMode,"debug_pca_variance.rda"),q="R.ScriptEvalExStr('"+n+"','"+f+" library(jsonlite); pca_result<-prcomp(data.frame("+l+"), center = TRUE, scale = TRUE); json<-toJSON(summary(pca_result)$importance); json;',"+p+")";r.displayRScriptsToConsole(o.props.debugMode,[q]);var b=[{qDef:{qDef:q}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return a.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(t)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(b)}],!1),a.patchApplied=!0,null},drawChart:function(o){var s=a.defer(),t=o.layout,i=(r.validateDimension(t.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return o.backendApi.getData(i).then(function(a){o.layout.qHyperCube.qMeasureInfo;if(0===a[0].qMatrix[0][1].qText.length||"-"==a[0].qMatrix[0][1].qText)r.displayConnectionError(o.extId);else{r.displayReturnedDatasetToConsole(t.props.debugMode,a[0]);for(var i=r.getDefaultPaletteColor(),p=JSON.parse(a[0].qMatrix[0][1].qText),l=p[1],n=p[2],d=[],u=0;u<l.length;u++)d.push("PC"+(u+1));var c=[{x:d,y:l,name:"Proportion of variance",mode:"lines+markers",type:"bar",fill:t.props.line,fillcolor:t.props.colors?"rgba("+i[3]+",0.3)":"rgba("+i[t.props.colorForMain]+",0.3)",marker:{color:t.props.colors?"rgba("+i[3]+",1)":"rgba("+i[t.props.colorForMain]+",1)",size:t.props.datapoints?t.props.pointRadius:1},line:{width:t.props.borderWidth}},{x:d,y:n,name:"Cumulative proportion",mode:"lines+markers",fill:t.props.line,fillcolor:t.props.colors?"rgba("+i[7]+",0.3)":"rgba("+i[t.props.colorForSub]+",0.3)",marker:{color:t.props.colors?"rgba("+i[7]+",1)":"rgba("+i[t.props.colorForSub]+",1)",size:t.props.datapoints?t.props.pointRadius:1},line:{width:t.props.borderWidth}}],f={showlegend:o.layout.props.showLegend,xaxis:{title:o.layout.props.xLabelsAndTitle?"Principal components":"",showgrid:o.layout.props.xScale,side:o.layout.props.xAxisPosition,type:o.layout.props.xAxisType},yaxis:{title:o.layout.props.yLabelsAndTitle?"Variance":"",showgrid:o.layout.props.yScale,side:o.layout.props.yAxisPosition,tickformat:r.getTickFormat(o,0),tickprefix:r.getPrefix(o,0),ticksuffix:r.getSuffix(o,0)}};$(".advanced-analytics-toolsets-"+o.extId).html('<div id="aat-chart-'+o.extId+'" style="width:100%;height:100%;"></div>'),e.draw(o,c,"aat-chart-"+o.extId,f)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/pca_variance.js.map
