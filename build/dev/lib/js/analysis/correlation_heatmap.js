"use strict";define(["../chart/heatmap","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var t=r.layout,s=a.validateDimension(t.props.dimensions[0]),o=[{qNullSuppression:!0,qDef:{qFieldDefs:[s]}}],l=t.props.measures.length;r.rowsLabel=[t.props.measures[0].label];for(var i=a.validateMeasure(t.props.measures[0])+" as mea0",n="q$mea0",p="N",u=1;u<l;u++){var d=a.validateMeasure(t.props.measures[u]);if(d.length>0){var q=","+d+" as mea"+u;i+=q,n+=", q$mea"+u,p+="N",r.rowsLabel.push(t.props.measures[u].label)}}a.displayDebugModeMessage(t.props.debugMode);var f=a.getDebugSaveDatasetScript(t.props.debugMode,"debug_correlation_heatmap.rda"),b="R.ScriptEvalExStr('"+p+"','"+f+" library(jsonlite);res<-cor(data.frame("+n+"));json<-toJSON(res);json;',"+i+")";a.displayRScriptsToConsole(t.props.debugMode,[b]);var h=[{qDef:{qDef:b}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(h)}],!1),r.patchApplied=!0,null},drawChart:function(t){var s=r.defer(),o=t.layout,l=(a.validateDimension(o.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1}]);return t.backendApi.getData(l).then(function(r){t.layout.qHyperCube.qMeasureInfo;if(0===r[0].qMatrix[0][1].qText.length||"-"==r[0].qMatrix[0][1].qText)a.displayConnectionError(t.extId);else{a.displayReturnedDatasetToConsole(o.props.debugMode,r[0]);var l=(a.getDefaultPaletteColor(),JSON.parse(r[0].qMatrix[0][1].qText)),i=[{x:t.rowsLabel,y:t.rowsLabel,z:l,type:"heatmap",showscale:!0}],n=[];n.annotations=[];for(var p=0;p<t.rowsLabel.length;p++)for(var u=0;u<t.rowsLabel.length;u++){var d={xref:"x1",yref:"y1",x:t.rowsLabel[u],y:t.rowsLabel[p],text:l[p][u],showarrow:!1,font:{color:"white"}};n.annotations.push(d)}$(".advanced-analytics-toolsets-"+t.extId).html('<div id="aat-chart-'+t.extId+'" style="width:100%;height:100%;"></div>'),e.draw(t,i,"aat-chart-"+t.extId,n)}return s.resolve()}),s.promise}}});
//# sourceMappingURL=../../maps/analysis/correlation_heatmap.js.map
