"use strict";define(["../chart/line_chart","../util/utils","ng!$q"],function(e,a,r){return{createCube:function(e,r){var s=r.layout,i=a.validateDimension(s.props.dimensions[0]),o=[{qDef:{qFieldDefs:[i]}}],p=a.validateMeasure(s.props.measures[0]),t=null;t=1===s.props.differencing?"R.ScriptEval('diff(na.omit(q$Measure),  "+s.props.seasonalDifferences+")', "+p+" as Measure)":2===s.props.differencing?"R.ScriptEval('diff(diff(na.omit(q$Measure), "+s.props.seasonalDifferences+"), "+s.props.firstDifferences+")', "+p+" as Measure)":p;var n="";s.props.lagMax===!1&&(n=", lag.max="+s.props.lagMaxValue+" ");var f=["acf","pacf"],l=[];$.each(f,function(e,a){1===s.props.differencing?l[a]=a+"(diff(na.omit(q$Measure), "+s.props.seasonalDifferences+"),plot=FALSE "+n+")$acf":2===s.props.differencing?l[a]=a+"(diff(diff(na.omit(q$Measure), "+s.props.seasonalDifferences+"), "+s.props.firstDifferences+"),plot=FALSE "+n+")$acf":l[a]=a+"(na.omit(q$Measure),plot=FALSE "+n+")$acf"}),a.displayDebugModeMessage(s.props.debugMode);var c=a.getDebugSaveDatasetScript(s.props.debugMode,"debug_autocorrelation.rda"),u="R.ScriptEval('"+c+" "+l.acf+"', "+p+" as Measure)",d="R.ScriptEval('"+l.pacf+"', "+p+" as Measure)",q="R.ScriptEval('high<-qnorm((1 + 0.95)/2)/sqrt(length(q$Measure));low<-qnorm((1 - 0.95)/2)/sqrt(length(q$Measure));c(high, low)', "+p+" as Measure)";a.displayRScriptsToConsole(s.props.debugMode,[u,d,q]);var x=[{qDef:{qDef:t}},{qDef:{qDef:u}},{qDef:{qDef:d}},{qDef:{qDef:q}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(o)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(x)}],!1),r.patchApplied=!0,null},drawChart:function(s,i){var o=r.defer(),p=s.layout,t=(a.validateDimension(p.props.dimensions[0]),[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}]);return s.backendApi.getData(t).then(function(r){var t=s.layout.qHyperCube.qMeasureInfo;return isNaN(t[0].qMin)&&isNaN(t[0].qMax)&&isNaN(t[1].qMin)&&isNaN(t[1].qMax)&&isNaN(t[2].qMin)&&isNaN(t[2].qMax)&&isNaN(t[3].qMin)&&isNaN(t[3].qMax)?a.displayConnectionError(s.extId):!function(){a.displayReturnedDatasetToConsole(p.props.debugMode,r[0]);var o=a.getDefaultPaletteColor(),t=r[0].qMatrix[0][4].qNum,n=r[0].qMatrix[1][4].qNum,f=[],l=[],c=[];if($.each(r[0].qMatrix,function(e,a){f.push(a[0].qElemNumber),l.push(a[0].qText),c.push(a[1].qNum)}),1===p.props.differencing||2===p.props.differencing)for(var u=0;u<p.props.seasonalDifferences;u++)l.shift();if(2===p.props.differencing)for(var d=0;d<p.props.firstDifferences;d++)l.shift();var q=[{x:l,y:c,elemNum:f,name:"Observed",mode:"lines+markers",fill:p.props.line,fillcolor:p.props.colors?"rgba("+o[3]+",0.3)":"rgba("+o[p.props.colorForMain]+",0.3)",marker:{color:p.props.colors?"rgba("+o[3]+",1)":"rgba("+o[p.props.colorForMain]+",1)",size:p.props.datapoints?p.props.pointRadius:1},line:{width:p.props.borderWidth},xaxis:"x",yaxis:"y"}],x=void 0,h=void 0,g=void 0,y=void 0,m=void 0,M=[];M[2]=2,M[3]=4;for(var v=function(e){x=[],h=[],g=[],y=[],m={};var a=e-2;$.each(r[0].qMatrix,function(r,s){return"-"!==s[e].qText&&(x.push(a),h.push(s[e].qNum),g.push(t),y.push(n),void a++)}),q.push({x:x,y:h,name:2===e?"Autocorrelation":"Partial Autocorrelation",marker:{color:"rgba("+o[p.props.colorForMain]+",1)"},type:"bar",width:.3,xaxis:"x"+e,yaxis:"y"+e}),q.push({x:x,y:g,name:"Upper",type:"scatter",line:{color:"rgba("+o[p.props.colorForSub]+",1)",dash:"dash"},marker:{size:1},xaxis:"x"+e,yaxis:"y"+e}),q.push({x:x,y:y,name:"Lower",type:"scatter",line:{color:"rgba("+o[p.props.colorForSub]+",1)",dash:"dash"},marker:{size:1},xaxis:"x"+e,yaxis:"y"+e})},D=2;D<4;D++)v(D);var b={xaxis:{zeroline:!1,showgrid:s.layout.props.xScale},yaxis:{domain:[.65,1],tickformat:a.getTickFormat(s,0),tickprefix:a.getPrefix(s,0),ticksuffix:a.getSuffix(s,0),showgrid:s.layout.props.yScale},xaxis2:{domain:[0,.45],anchor:"y2",showgrid:s.layout.props.xScale},yaxis2:{domain:[0,.45],anchor:"x2",showgrid:s.layout.props.yScale},xaxis3:{domain:[.55,1],anchor:"y3",showgrid:s.layout.props.xScale},yaxis3:{domain:[0,.45],anchor:"x3",showgrid:s.layout.props.yScale}};$(".advanced-analytics-toolsets-"+s.extId).html('<div id="aat-chart-'+s.extId+'" class="simple" style="width:100%;height:100%;"></div>');var N=e.draw(s,q,"aat-chart-"+s.extId,b);e.setEvents(N,s,i)}(),o.resolve()}),o.promise}}});
//# sourceMappingURL=../../maps/analysis/autocorrelation.js.map
